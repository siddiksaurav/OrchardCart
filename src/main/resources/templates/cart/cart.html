
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Shopping Cart</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

</head>
<body>

<div class="container">
    <h2 class="mb-4">Your Shopping Cart</h2>
    <form th:action="@{/cart/update}" method="post" id="cartForm" th:object="${cart}">
        <table class="table">

            <input type="hidden" th:field="*{id}" />
            <input type="hidden" th:field="*{userInfo}" />
            <tr th:each="cartItem, rowStat : ${cart.cartItems}">
                <input type="hidden" th:field="*{cartItems[__${rowStat.index}__].id}" />
                <input type="hidden" th:field="*{cartItems[__${rowStat.index}__].cart}" />
                <input type="hidden" th:field="*{cartItems[__${rowStat.index}__].product}" />
                <input type="hidden" th:field="*{cartItems[__${rowStat.index}__].price}" />
                <input type="hidden" th:field="*{cartItems[__${rowStat.index}__].userId}"/>
                <td th:text="${cartItem.product.name}"></td>
                <td>
                    <input type="number" th:field="*{cartItems[__${rowStat.index}__].quantity}" class="quantity-input" onchange="updateTotalPrice(this)" />
                </td>
                <td th:text="${cartItem.price}"></td>
            </tr>
        </table>
        <input type="hidden" th:field="*{totalItem}" />
        <input type="hidden" th:field="*{totalPrice}" />


        <div>
            <p>Total Price: <input name="totalPrice" th:field="*{totalPrice}" /></p>
        </div>



        <div class="mt-4">
            <button type="button" class="btn btn-primary" onclick="checkout()">Checkout</button>
        </div>
    </form>
</div>


<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>


<script>
    function updateTotalPrice(input) {
        var totalPrice = 0.0;

        $('.quantity-input').each(function () {
            var quantity = $(this).val();
            var price = parseFloat($(this).closest('tr').find('td:last').text());

            if (quantity > 0) {
                totalPrice += quantity * price;
            } else {
                $(this).closest('tr').remove();
            }
        });
        $('#totalPrice').text('$' + totalPrice.toFixed(2));
        $('input[name="totalPrice"]').val(totalPrice.toFixed(2));
    }

    function checkout() {
        $('#cartForm').submit();
    }
</script>



</body>
</html>



